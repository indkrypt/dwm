import pandas as pd
from mlxtend.frequent_patterns import apriori, association_rules

data = {
    'TransactionID': [1, 1, 1, 2, 2, 3, 3, 3, 4, 4, 5],
    'Item': ['Bread', 'Milk', 'Butter', 'Bread', 'Diaper',
             'Milk', 'Diaper', 'Beer', 'Bread', 'Diaper', 'Milk']
}

df = pd.DataFrame(data)

basket = (
    df.groupby(['TransactionID', 'Item'])['Item']
      .count()
      .unstack(fill_value=0)
)

# Convert to boolean type (recommended by mlxtend)
basket = basket.astype(bool)

print("Basket DataFrame:\n", basket)

frequent_itemsets = apriori(basket, min_support=0.3, use_colnames=True)
print("\nFrequent Itemsets:\n", frequent_itemsets)

rules = association_rules(frequent_itemsets, metric="lift", min_threshold=1.0)
print("\nAssociation Rules:\n", rules[['antecedents', 'consequents', 'support', 'confidence', 'lift']])
